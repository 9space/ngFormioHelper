!function e(r,o,s){function t(n,a){if(!o[n]){if(!r[n]){var u="function"==typeof require&&require;if(!a&&u)return u(n,!0);if(i)return i(n,!0);var m=new Error("Cannot find module '"+n+"'");throw m.code="MODULE_NOT_FOUND",m}var l=o[n]={exports:{}};r[n][0].call(l.exports,function(e){var o=r[n][1][e];return t(o?o:e)},l,l.exports,e,r,o,s)}return o[n].exports}for(var i="function"==typeof require&&require,n=0;n<s.length;n++)t(s[n]);return t}({1:[function(e,r,o){"use strict";angular.module("ngFormioHelper",["formio","ngFormioGrid","ui.router"]).filter("capitalize",[function(){return _.capitalize}]).filter("truncate",[function(){return function(e,r){return _.isNumber(r)&&(r={length:r}),_.truncate(e,r)}}]).directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,r){r.bind("change",function(r){var o=new FileReader;o.onloadend=function(r){e.$apply(function(){e.fileread=jQuery(r.target.result)})},o.readAsText(r.target.files[0])})}}}]).provider("FormioResource",["$stateProvider",function(e){var r={};return{register:function(o,s,t){t=t||{},r[o]=t.title||o;var i=t&&t.parent?t.parent:null,n=o+"Id";t.base=t.base||"";var a=t.base+o,u=function(e){var r={};return r[n]=e._id,r},m=function(e){return e};t.alter=angular.extend({index:m,create:m,"abstract":m,view:m,edit:m,"delete":m},t.alter);var l=t&&t.templates?t.templates:{},c=t&&t.controllers?t.controllers:{},f=t.query?t.query:"";e.state(a+"Index",t.alter.index({url:"/"+o+f,parent:i?i:null,params:t.params&&t.params.index,templateUrl:l.index?l.index:"formio-helper/resource/index.html",controller:["$scope","$state","$controller",function(e,r,t){e.currentResource={name:o,queryId:n,formUrl:s,columns:[],gridOptions:{}},e.$on("rowView",function(e,s){r.go(o+".view",u(s))}),e.$on("submissionView",function(e,s){r.go(o+".view",u(s))}),e.$on("submissionEdit",function(e,s){r.go(o+".edit",u(s))}),e.$on("submissionDelete",function(e,s){r.go(o+".delete",u(s))}),c.index&&t(c.index,{$scope:e})}]})).state(a+"Create",t.alter.create({url:"/create/"+o+f,parent:i?i:null,params:t.params&&t.params.create,templateUrl:l.create?l.create:"formio-helper/resource/create.html",controller:["$scope","$state","$controller",function(e,r,a){e.currentResource={name:o,queryId:n,formUrl:s},e.submission=t.defaultValue?t.defaultValue:{data:{}},e.pageTitle="New "+_.capitalize(o);var m=!1;if(c.create){var l=a(c.create,{$scope:e});m=l.handle||!1}i&&(e.hideComponents||(e.hideComponents=[]),e.hideComponents.push(i),e[i].loadSubmissionPromise.then(function(r){e.submission.data[i]=r})),m||e.$on("formSubmission",function(s,t){e.currentResource.resource=t,r.go(o+".view",u(t))})}]})).state(a,t.alter["abstract"]({"abstract":!0,url:"/"+o+"/:"+n,parent:i?i:null,templateUrl:l["abstract"]?l["abstract"]:"formio-helper/resource/resource.html",controller:["$scope","$stateParams","Formio","$controller","$http",function(e,r,a,u,m){var l=s,f=t.endpoint;f?f+="/"+r[n]:l+="/submission/"+r[n],e.currentResource=e[o]={name:o,queryId:n,formUrl:s,submissionUrl:l,formio:new a(l),resource:{},form:{},href:"/#/"+o+"/"+r[n]+"/",parent:i?e[i]:{href:"/#/",name:"home"}},e.currentResource.loadFormPromise=e.currentResource.formio.loadForm().then(function(r){return e.currentResource.form=e[o].form=r,r}),t.endpoint?e.currentResource.loadSubmissionPromise=m.get(f,{headers:{"x-jwt-token":a.getToken()}}).then(function(r){return e.currentResource.resource=r.data,r.data}):e.currentResource.loadSubmissionPromise=e.currentResource.formio.loadSubmission().then(function(r){return e.currentResource.resource=e[o].submission=r,r}),c["abstract"]&&u(c["abstract"],{$scope:e})}]})).state(a+".view",t.alter.view({url:"/",parent:a,params:t.params&&t.params.view,templateUrl:l.view?l.view:"formio-helper/resource/view.html",controller:["$scope","$controller",function(e,r){c.view&&r(c.view,{$scope:e})}]})).state(a+".edit",t.alter.edit({url:"/edit",parent:a,params:t.params&&t.params.edit,templateUrl:l.edit?l.edit:"formio-helper/resource/edit.html",controller:["$scope","$state","$controller",function(e,r,s){var t=!1;if(c.edit){var i=s(c.edit,{$scope:e});t=i.handle||!1}t||e.$on("formSubmission",function(s,t){e.currentResource.resource=t,r.go(o+".view",u(t))})}]})).state(a+".delete",t.alter["delete"]({url:"/delete",parent:a,params:t.params&&t.params["delete"],templateUrl:l["delete"]?l["delete"]:"formio-helper/resource/delete.html",controller:["$scope","$state","$controller",function(e,r,s){var t=!1;if(e.resourceName=o,c["delete"]){var n=s(c["delete"],{$scope:e});t=n.handle||!1}t||(e.$on("delete",function(){i&&"home"!==i?r.go(i+".view"):r.go("home",null,{reload:!0})}),e.$on("cancel",function(){r.go(o+"Index")}))}]}))},$get:function(){return r}}}]).directive("formioForms",function(){return{restrict:"E",replace:!0,scope:{src:"=",base:"=",tag:"=?"},templateUrl:"formio-helper/form/list.html",controller:["$scope","Formio",function(e,r){e.forms=[];var o={type:"form",limit:9999999},s=function(){e.src&&(e.tag&&(o.tags=e.tag),new r(e.src).loadForms({params:o}).then(function(r){e.forms=r}))};e.$watch("src",s)}]}}).provider("FormioForms",["$stateProvider",function(e){var r={};return{register:function(r,o,s){s=s||{};var t=s.templates?s.templates:{},i=s.controllers?s.controllers:{},n="string"==typeof s.field?[s.field]:s.field,a=s.base?s.base:"";a||(a=r?r+".":""),e.state(a+"formIndex",{url:"/forms",params:s.params&&s.params.index,templateUrl:t.index?t.index:"formio-helper/form/index.html",controller:["$scope","Formio","$controller",function(e,r,t){e.formBase=a,e.formsSrc=o+"/form",e.formsTag=e.formsTag||s.tag,i.index&&t(i.index,{$scope:e})}]}).state(a+"form",{url:"/form/:formId","abstract":!0,templateUrl:t.form?t.form:"formio-helper/form/form.html",controller:["$scope","$stateParams","Formio","$controller",function(e,s,t,n){var u=o+"/form/"+s.formId;e.formBase=a,e.currentForm={name:r,url:u,form:{}},e.currentForm.formio=new t(u),e.currentForm.promise=e.currentForm.formio.loadForm().then(function(r){return e.currentForm.form=r,r}),i.form&&n(i.form,{$scope:e})}]}).state(a+"form.view",{url:"/",params:s.params&&s.params.view,templateUrl:t.view?t.view:"formio-helper/form/view.html",controller:["$scope","$state","FormioUtils","$controller",function(e,r,o,s){e.submission={data:{}};var t=!1;if(n&&n.length&&(e.hideComponents=n,e.currentForm.promise.then(function(){n.forEach(function(r){e[r].loadSubmissionPromise.then(function(o){e.submission.data[r]=o})})})),i.view){var u=s(i.view,{$scope:e});t=u.handle||!1}t||e.$on("formSubmission",function(){r.go(a+"form.submissions")})}]}).state(a+"form.submissions",{url:"/submissions",params:s.params&&s.params.submissions,templateUrl:t.submissions?t.submissions:"formio-helper/submission/index.html",controller:["$scope","$state","$stateParams","FormioUtils","$controller",function(e,r,o,s,t){e.submissionQuery={},e.submissionColumns=[],n&&n.length&&n.forEach(function(r){e.submissionQuery["data."+r+"._id"]=o[r+"Id"]}),e.$on("rowView",function(e,o){r.go(a+"form.submission.view",{formId:o.form,submissionId:o._id})}),i.submissions&&t(i.submissions,{$scope:e}),e.currentForm.promise.then(function(r){localStorage.setItem(r.name,""),e.submissionColumns.length||0!==!Object.keys(e.submissionColumns).length||(s.eachComponent(r.components,function(r){r.key&&r.input&&r.tableView&&(n&&n.length&&-1!==n.indexOf(r.key)||e.submissionColumns.push(r.key))}),e.$broadcast("reloadGrid"))})}]}).state(a+"form.submission",{"abstract":!0,url:"/submission/:submissionId",params:s.params&&s.params.submission,templateUrl:t.submission?t.submission:"formio-helper/submission/submission.html",controller:["$scope","$stateParams","Formio","$controller",function(e,r,o,s){e.currentSubmission={url:e.currentForm.url+"/submission/"+r.submissionId,submission:{data:{}}},e.currentSubmission.formio=new o(e.currentSubmission.url),e.currentSubmission.promise=e.currentSubmission.formio.loadSubmission().then(function(r){return e.currentSubmission.submission=r,r}),i.submission&&s(i.submission,{$scope:e})}]}).state(a+"form.submission.view",{url:"/",params:s.params&&s.params.submissionView,templateUrl:t.submissionView?t.submissionView:"formio-helper/submission/view.html",controller:["$scope","$controller",function(e,r){i.submissionView&&r(i.submissionView,{$scope:e})}]}).state(a+"form.submission.edit",{url:"/edit",params:s.params&&s.params.submissionEdit,templateUrl:t.submissionEdit?t.submissionEdit:"formio-helper/submission/edit.html",controller:["$scope","$state","$controller",function(e,r,o){var s=!1;if(i.submissionEdit){var t=o(i.submissionEdit,{$scope:e});s=t.handle||!1}s||e.$on("formSubmission",function(o,s){e.currentSubmission.submission=s,r.go(a+"form.submission.view")})}]}).state(a+"form.submission.delete",{url:"/delete",params:s.params&&s.params.submissionDelete,templateUrl:t.submissionDelete?t.submissionDelete:"formio-helper/submission/delete.html",controller:["$scope","$state","$controller",function(e,r,o){var s=!1;if(i.submissionDelete){var t=o(i.submissionDelete,{$scope:e});s=t.handle||!1}s||(e.$on("delete",function(){r.go(a+"form.submissions")}),e.$on("cancel",function(){r.go(a+"form.submission.view")}))}]})},$get:function(){return r}}}]).provider("FormioAuth",["$stateProvider",function(e){var r=!1,o="auth.login",s=!1,t="",i="home",n=!1,a=!1,u={};return{setForceAuth:function(e){n=e},setStates:function(e,r){o=e,i=r},setAnonRole:function(e){s=e},setAppUrl:function(e){t=e},register:function(r,o,s){a||(a=!0,e.state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/user/auth.html"})),s||(s=r),e.state("auth."+r,{url:"/"+s,parent:"auth",templateUrl:"views/user/"+r.toLowerCase()+".html",controller:["$scope","$state","$rootScope",function(e,r,s){e.$on("formSubmission",function(e,t){t&&(s.setUser(t,o),r.go(i))})}]})},$get:["Formio","FormioAlerts","$rootScope","$state",function(e,i,a,m){return{init:function(){r=!0,new e(t).loadForms({params:{limit:9999999}}).then(function(e){e.forEach(function(e){u[e.name]={},e.submissionAccess.forEach(function(r){u[e.name][r.type]=r.roles})})}),a.user={},a.isRole=function(e){return a.role===e.toLowerCase()},a.setUser=function(r,o){r?(a.user=r,localStorage.setItem("formioAppUser",angular.toJson(r))):(a.user=null,localStorage.removeItem("formioAppUser"),localStorage.removeItem("formioUser"),localStorage.removeItem("formioToken")),o?(a.role=o.toLowerCase(),localStorage.setItem("formioAppRole",o)):(a.role=null,localStorage.removeItem("formioAppRole")),a.authenticated=!!e.getToken(),a.$emit("user",{user:a.user,role:a.role})},a.hasAccess=function(e,o){if(!r)return!0;if(Array.isArray(o)||(o=[o]),!u[e])return!1;var t=!1;return o.forEach(function(r){a.user?a.user.roles.forEach(function(o){-1!==u[e][r].indexOf(o)&&(t=!0)}):-1!==u[e][r].indexOf(s)&&(t=!0)}),t};var l=localStorage.getItem("formioAppUser");a.setUser(l?angular.fromJson(l):null,localStorage.getItem("formioAppRole")),a.user||e.currentUser().then(function(e){a.setUser(e,localStorage.getItem("formioRole"))});var c=function(){m.go(o,{},{reload:!0}),i.addAlert({type:"danger",message:"Your session has expired. Please log in again."})};a.$on("formio.sessionExpired",c),a.logout=function(){a.setUser(null,null),e.logout().then(function(){m.go(o,{},{reload:!0})})["catch"](c)},a.$on("$stateChangeStart",function(r,s){if(a.authenticated=!!e.getToken(),n){if("auth"===s.name.substr(0,4))return;a.authenticated||(r.preventDefault(),m.go(o,{},{reload:!0}))}}),a.$on("$stateChangeSuccess",function(){a.alerts=i.getAlerts()})}}}]}}]).factory("FormioAlerts",["$rootScope",function(e){var r=[];return{addAlert:function(o){e.alerts.push(o),o.element?angular.element("#form-group-"+o.element).addClass("has-error"):r.push(o)},getAlerts:function(){var e=angular.copy(r);return r.length=0,r=[],e},onError:function o(e){if(e.message)this.addAlert({type:"danger",message:e.message,element:e.path});else{var r=e.hasOwnProperty("errors")?e.errors:e.data.errors;angular.forEach(r,o.bind(this))}}}}]).run(["$templateCache","$rootScope","$state",function(e,r,o){r.isActive=function(e){return-1!==o.current.name.indexOf(e)},e.put("formio-helper/resource/resource.html",'<h2>{{ currentResource.name | capitalize }}</h2>\n<ul class="nav nav-tabs">\n  <li role="presentation" ng-class="{active:isActive(currentResource.name + \'.view\')}" ng-if="hasAccess(currentResource.name, [\'read_all\', \'read_own\'])"><a ui-sref="{{ currentResource.name }}.view()">View</a></li>\n  <li role="presentation" ng-class="{active:isActive(currentResource.name + \'.edit\')}" ng-if="hasAccess(currentResource.name, [\'update_all\', \'update_own\'])"><a ui-sref="{{ currentResource.name }}.edit()">Edit</a></li>\n  <li role="presentation" ng-class="{active:isActive(currentResource.name + \'.delete\')}" ng-if="hasAccess(currentResource.name, [\'delete_all\', \'delete_own\'])"><a ui-sref="{{ currentResource.name }}.delete()">Delete</a></li>\n</ul>\n<div ui-view></div>\n'),e.put("formio-helper/resource/create.html",'<h3 ng-if="pageTitle">{{ pageTitle }}</h3>\n<hr ng-if="pageTitle"></hr>\n<formio src="currentResource.formUrl" submission="submission" hide-components="hideComponents"></formio>\n'),e.put("formio-helper/resource/delete.html",'<formio-delete src="currentResource.submissionUrl" resource-name="resourceName"></formio-delete>\n'),e.put("formio-helper/resource/edit.html",'<formio src="currentResource.submissionUrl"></formio>\n'),e.put("formio-helper/resource/index.html",'<formio-grid src="currentResource.formUrl" columns="currentResource.columns" grid-options="currentResource.gridOptions"></formio-grid><br/>\n<a ui-sref="{{ currentResource.name }}Create()" class="btn btn-primary" ng-if="hasAccess(currentResource.name, \'create_own\')"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New {{ currentResource.name | capitalize }}</a>\n'),e.put("formio-helper/resource/view.html",'<formio src="currentResource.submissionUrl" read-only="true"></formio>\n'),e.put("formio-helper/form/list.html",'<ul class="list-group">\n    <li class="list-group-item" ng-repeat="form in forms | orderBy: \'title\'"><a ui-sref="{{ base }}form.view({formId: form._id})">{{ form.title }}</a></li>\n</ul>\n'),e.put("formio-helper/form/index.html",'<formio-forms src="formsSrc" tag="formsTag" base="formBase"></formio-forms>\n'),e.put("formio-helper/form/form.html",'<ul class="nav nav-tabs">\n    <li role="presentation" ng-class="{active:isActive(formBase + \'form.view\')}"><a ui-sref="{{ formBase }}form.view()">Form</a></li>\n    <li role="presentation" ng-class="{active:isActive(formBase + \'form.submissions\')}"><a ui-sref="{{ formBase }}form.submissions()">Submissions</a></li>\n</ul>\n<div ui-view style="margin-top:20px;"></div>\n'),e.put("formio-helper/form/view.html",'<formio form="currentForm.form" form-action="currentForm.url + \'/submission\'" submission="submission"></formio>\n'),e.put("formio-helper/submission/index.html",'<formio-grid src="currentForm.url" query="submissionQuery" columns="submissionColumns"></formio-grid>\n\n'),e.put("formio-helper/submission/submission.html",'<ul class="nav nav-pills">\n  <li role="presentation" ng-class="{active:isActive(formBase + \'form.submission.view\')}"><a ui-sref="{{ formBase }}form.submission.view()">View</a></li>\n  <li role="presentation" ng-class="{active:isActive(formBase + \'form.submission.edit\')}"><a ui-sref="{{ formBase }}form.submission.edit()">Edit</a></li>\n  <li role="presentation" ng-class="{active:isActive(formBase + \'form.submission.delete\')}"><a ui-sref="{{ formBase }}form.submission.delete()">Delete</a></li>\n</ul>\n<div ui-view style="margin-top:20px;"></div>\n'),e.put("formio-helper/submission/view.html",'<formio form="currentForm.form" submission="currentSubmission.submission" read-only="true"></formio>\n'),e.put("formio-helper/submission/edit.html",'<formio form="currentForm.form" submission="currentSubmission.submission" form-action="currentSubmission.url"></formio>\n'),e.put("formio-helper/submission/delete.html",'<formio-delete src="currentSubmission.url"></formio-delete>\n')}])},{}]},{},[1]);